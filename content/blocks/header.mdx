import { useSiteMetadata, useColorMode } from "@reflexjs/gatsby-theme-core"
import bgImage from "../images/noisy-texture.png"

export const HeaderBlock = ({ ...props }) => {
  const [showMenu, setShowMenu] = React.useState(false)
  const navName = "header"
  const bgImageUrl = `url(${bgImage})`
  return (
    <Header
      position={["sticky", "relative"]}
      top="0"
      bg="background"
      zIndex="1000"
      {...props}
    >
      <Flexbox d={["none", "flex"]} flexWrap="wrap" justifyContent="center">
        <Flexbox
          justifyContent="center"
          flexBasis="100%"
          py="2"
        >
          <SvgLogo />
        </Flexbox>
        <Flexbox
          bg="secondary"
          backgroundImage={bgImageUrl}
          justifyContent="center"
          flexBasis="100%"
          py="1"
        >
          <NavMenu
            name={navName}
            gap={[0, 8, 14]}
            mr="null|10"
            color="background"
          />
          <ModeToggle ml="0" />
        </Flexbox>
      </Flexbox>
      <Flexbox
        d={["flex", "none"]}
        flexDirection="column"
        justifyContent="center"
      >
        <Flexbox
          justifyContent="space-between"
          w="full"
          pl="4"
          pr="1"
          visibility={showMenu ? "hidden" : "visible"}
          transition="all .15s ease-in"
        >
          <SvgLogo />
          <Button
            variant="link"
            outline="none"
            onClick={() => setShowMenu(true)}
          >
            <Icon name="menu" size="7" />
          </Button>
        </Flexbox>
        <Div
          position="absolute"
          zIndex="1000"
          bg="background"
          top="4"
          left="4"
          right="4"
          px="4"
          rounded="xl"
          overflow="scroll"
          boxShadow="3xl"
          border="1px solid"
          borderColor="border"
          transform={`scale(${showMenu ? 1 : 0.95})`}
          visibility={showMenu ? "visible" : "hidden"}
          opacity={showMenu ? 1 : 0}
          transition="all .25s ease-in"
          transformOrigin="100% 0"
          maxHeight="95vh"
        >
          <Flexbox justifyContent="space-between" w="full" py="2" px="0">
            <SvgLogo />
            <Button variant="link" onClick={() => setShowMenu(false)} mr={-3}>
              <Icon name="x" size="6" />
            </Button>
          </Flexbox>
          <NavMenu name={navName} gap={[0, 8]} borderTopWidth="1px" />
          <Flexbox py="4" justifyContent="space-between">
            <ModeToggle ml="auto" />
          </Flexbox>
        </Div>
      </Flexbox>
    </Header>
  )
}

export const SvgLogo = () => {
  return (
    <A href="/" flexBasis="100%" maxWidth="320px" color="text" hoverColor="text">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="100%" viewbox="0 0 697 203" preserveAspectRatio="none">
        <path d="M563.068 161.032c.104-.12.27-.247.495-.379 1.667-.974 2.033-3.42 1.605-4.213-.428-.793.138.991-.531 1.086-1.519.216-1.732-1.314-1.966-3.416v-.231c.192-2.303 1.444-1.708 2.92-.812.693.42 1.647 3.079 1.501 5.283-.074 1.122-.317 2.029-.726 2.682h14.373v.124c2.366-.53 3.292-2.255 2.874-2.87-.417-.615 0 .728-.895.728-2.032 0-2.032-1.124-1.957-2.662l.042-.166c.671-1.639 2.206-1.082 3.98-.286.833.374 1.6 2.386 1.007 3.959-.605 1.604-3.072 3.141-5.051 3.141H394v-4.022c6.292 0 9.743-2.523 9.078-7.01V50.213c-.84-4.21-3.866-6.315-9.078-6.315V39h23.741c10.3 0 15.486 1.903 20.949 7.251 7.104 6.956 8.803 12.152 8.803 25.329 0 10.797-1.699 23.553-6.496 30.896-1.101 1.893-2.19 3.319-3.265 4.277-2.637 2.348-4.622 2.89-6.97 3.512l-.606.161c-9.705 1.937-14.762-3.915-14.759-15.067l.024-.163c1.793-7.089 5.587-9.53 12.76-7.007l.303.106.185.243c3.054 4.005 3.053 8.105-.002 12.08l-.168.218-.267.108c-4.897 1.992-7.786.341-7.783-4.519.211-2.407 1.832-3.466 4.243-2.729l.393.12.2.333c.71 1.188.679 2.276-.193 3.048h-2.139c0 2.305.844 3.365 4.15 2.087 2.318-3.15 2.323-6.218.015-9.395-5.736-1.915-8.114-.137-9.61 5.636.03 9.854 4.274 13.318 11.159 12.32 1.445-.48 2.512-1.141 3.201-1.983 1.034-1.262 2.283-3.805 2.283-5.245 0-9.42-.242 2.512.698-26.01.94-28.52-5.511-28.718-17.089-28.718h-3.335v79.714l.074 26.546c0 4.412 2.818 7.373 8.454 8.883h7.835c3.166-5.049 4.883-8.483 5.071-10.067.3-2.54-.56-4.823-2.628-6.925-2.592-2.634-5.753-2.6-8.145-.072-2.325 2.456-2.754 6.084-.97 8.759 3.857 3.157 8.5.895 7.197-2.745-.428-1.193-1.306-1.803-2.168-1.658-.525.088-.593.263-.241.708l.304.384-1.518 1.23-.304-.384c-1.298-1.639-.532-3.548 1.44-3.88 1.819-.306 3.577.867 4.316 2.93.822 2.294-.162 4.877-2.312 6.176-2.362 1.427-5.366.943-8.106-1.378l-.126-.145c-2.416-3.473-1.905-8.202 1.083-11.359 3.144-3.322 7.56-3.378 10.928.045 2.48 2.52 3.555 5.394 3.181 8.548-.217 1.834-1.764 5.05-4.704 9.833h43.213c4.058-.548 15.66-.025 25.452-2.054 8.597-1.78 8.597-4.423 10.313-5.085 3.797-1.465 7.15.915 6.167 7.139h27.726l1.9-1.643c3.363-4.576 2.88-8.179-.265-10.27-2.054-1.366-4.212-1.239-5.806.226-1.351 1.242-1.593 3.666-.797 4.605 1.672 1.97 3.848 2.881 4.867 0 .26-.737-.54-1.555-1.019-1.252l-.412.26-1.03-1.67.412-.26c2.143-1.354 4.512 1.784 3.785 4.006-.711 2.176-5.138 3.003-7.686 0-1.55-1.826-1.011-4.709 1.083-6.633 2.256-2.073 5.39-2.27 8.183-.413 4.2 2.793 4.234 7.149.246 12.575l-.08.469h13.73zm-253.401-.126c.826-.587 1.261-2.031.93-2.516-.421-.614 0 .727-.902.727-2.047 0-2.047-1.123-1.971-2.659l.042-.167c.676-1.636 2.222-1.08 4.009-.285.838.373 1.61 2.384 1.013 3.955-.425 1.12-1.562 2.158-2.612 2.683v.228h-.548c-.252.083-.49.128-.7.128l.127-.128H141.31l-.286.128-.057-.128H122.84l-.317.125-.049-.125H48.632l-.522-1.966 6.45-2.015c1.912-1.097 2.868-3.107 2.868-6.031V46.259H50.74c-11.395.136-3.82 14.354-1.644 27.127.647 2.697.97 7.129.97 13.294 0 10.076-2.997 19.447-11.32 19.428-5.962-1.171-8.569-4.74-7.519-10.35l.054-.289.203-.211c4.951-5.155 9.02-5.11 11.26.305l.17.41-.196.4c-1.941 3.97-4.321 4.87-6.197 1.996l-.268-.412 1.64-1.077.268.412c.785 1.203 1.384.981 2.596-1.381-1.593-3.458-3.87-3.36-7.655.498-.712 4.332 1.182 6.82 5.833 7.751 6.793 0 9.888-10.307 9.175-17.367-.37-3.662-.898-6.71-1.587-9.143L32.603 39h61.682L81.504 79.888l-1.601 6.897c-.62 11.59 2.192 17.144 8.445 17.144 4.28-.92 6.024-3.375 5.369-7.652-3.484-3.807-5.58-3.904-7.046-.491 1.115 2.332 1.667 2.55 2.39 1.363l.246-.406 1.51 1.063-.248.406c-1.726 2.838-3.917 1.948-5.703-1.97l-.18-.394.156-.406c2.062-5.345 5.806-5.389 10.363-.301l.187.209.05.285c.967 5.537-1.433 9.06-6.92 10.217-7.66.018-11.097-6.521-10.42-19.178.302-5.626.6-9.093.895-10.403.906-12.31 10.23-29.983-4.208-29.835h-7.115V153.39c0 3.666 2.307 6.171 6.921 7.515h5.485c2.687-2.585 6.217-3.387 7.57-5.216 3.03-4.097 1.223-8.07-2.279-11.347-4.134-2.55-7.303-1.99-9.822 1.792 0 6.725 2.728 7.243 6.354 5.737.758-2.64.466-3.227-.969-2.865l-.49.124-.468-1.963.49-.124c3.428-.867 4.574 1.482 3.23 5.85l-.135.44-.417.192c-5.49 2.537-9.543-.277-9.616-7.65l-.003-.303.003-1.23c2.996-4.237 7.79-4.894 13.074-1.609 3.152 2.937 4.214 5.32 4.214 9.138 0 2.545-1.055 4.586-3.166 6.122-1.976 1.176-3.544 2.147-4.703 2.912h37.563c7.137-2.828 12.453-5.39 12.239-7.464l-.657.674h-.919c-1.578-1.906-.396-3.254 2.23-2.98l.486.05.252.42c1.885 3.141-1.432 6.2-7.755 9.3h13.529c8.36-3.764 13.233-7.19 12.874-10.123-.196.451-.413.726-.651.823-.239.097-.644.076-1.216-.062-1.335-2.413 0-3.66 2.364-3.284l.948.366c1.952 2.918-.96 8.138-8.838 12.28h40.966l36.669-6.259c4.007.503 4.65 2.59 1.93 6.259h33.078-1.403c4.327-2.015 6.639-6.447 5.11-9.567-1.922-3.927-9.91-2.005-9.159 1.742.603 3.01 3.106 1.915 4.049.555.628-.906 1.23-.65 1.803.768-1.866 4.415-6.783 4.006-7.773-.935-1.222-6.101 9.941-8.915 12.839-2.997 1.718 3.509.83 7.03-2.542 10.434h16.967l6.958-4.26c.85-.823 1.194-1.5 1.087-2.14-.369.398-.922.719-1.654.973l-.245.035c-2.167 0-3.4-1.213-3.298-3.378l.056-.235c.898-2.306 2.936-2.372 5.327-.402 2.387 1.967 2.379 4.364-.054 6.684l-4.433 2.723h27.993zM99.72 72.629c0-3.802-1.907-5.703-5.721-5.703V64h21.525v2.926c-3.899 0-5.848 1.901-5.848 5.703v22.503l14.919-.114c-.084-11.123-.127-18.586-.127-22.389 0-3.802-1.58-5.703-4.74-5.703V64h20.923v2.926c-4.066 0-6.1 1.901-6.1 5.703v61.856c0 3.675 2.15 5.512 6.448 5.512V143h-21.272v-3.003c3.245 0 4.868-1.837 4.868-5.512 0-3.676-.042-15.335-.127-34.98l-14.792.115v35.612c0 3.177 1.95 4.765 5.848 4.765V143H94v-3.003c3.814-.55 5.72-2.139 5.72-4.765V72.629zM184 98.64v7.605c0 10.6-2.993 36.755-18.331 36.755C150.33 143 146 128.474 146 101.512 146 78.93 154.026 62 165.916 62 179.17 62 184 85.62 184 98.64zm-11 9.45v-8.939c0-4.47 0-27.286-3.924-32.034-.846-.869-4.114-1.117-5.665-1.117-1.41 0-2.82.745-3.242 1.117-5.5 4.719-5.081 24.709-5.081 32.034v8.94c0 13.658-1.546 32.909 8.323 32.909 9.87 0 9.588-19.251 9.588-32.91zm173-9.45v7.605c0 10.6-2.993 36.755-18.331 36.755C312.33 143 308 128.474 308 101.512 308 78.93 316.026 62 327.916 62 341.17 62 346 85.62 346 98.64zm-10 9.45v-8.939c0-4.47 0-27.286-3.924-32.034-.846-.869-4.114-1.117-5.665-1.117-1.41 0-2.82.745-3.242 1.117-5.5 4.719-5.081 24.709-5.081 32.034v8.94c0 13.658-1.546 32.909 8.323 32.909 9.87 0 9.588-19.251 9.588-32.91zm-142.977 28.003v-65.3c0-2.126-1.507-3.189-4.52-3.189V64h21.151c7.508 0 16.59 7.591 16.59 20.367 0 9.354-2.379 19.133-11.397 21.76 1.574.684 1.538.53 2.65 2.395 4.968 8.338 5.953 31.488 11.503 31.488V143h-10.656c-3.497-1.95-5.952-36.657-13.333-36.657h-3.27v29.75c0 1.961 1.92 3.267 5.759 3.917V143H186v-2.99c4.682 0 7.023-1.306 7.023-3.917zM202 102h4.87c6.71 0 9.08-4.007 9.08-16.457 0-10.045 1.422-17.543-10.792-17.543H202v34zm394.45 34.093V69.818c0-2.126-1.483-3.108-4.45-2.944V64h16.954c7.39 0 16.332 7.591 16.332 20.367 0 9.354-2.341 19.133-11.22 21.76 1.55.684 1.515.53 2.609 2.395 4.89 8.338 5.861 31.488 11.325 31.488V143h-10.49c-3.444-1.95-2.959-36.657-10.225-36.657h-2.251v29.75c0 1.961.6 3.267 1.799 3.917V143h-12.46v-2.99c1.385 0 2.077-1.306 2.077-3.917zM604 102h4.521c6.232 0 8.432-4.007 8.432-16.457 0-10.045 1.32-17.543-10.02-17.543H604v34zM235.465 69.704L232 66.926V64h12.897l14.965 44.3c-.328-24.184-.492-37.125-.492-38.825 0-1.7-.95-2.55-2.85-2.55V64H268v2.926c-2.614 0-3.92.888-3.92 2.663V143h-4.514L240.05 88.229v49.067c0 1.758 1.196 2.637 3.588 2.637V143H232v-3.067c2.31 0 3.465-.917 3.465-2.75v-67.48zm118.66.975l-5.58-3.753V64h15.4l15.582 44.3c-.206-23.874-.309-36.777-.309-38.71 0-1.934-1.48-2.9-4.44-2.9l.282-2.69H388v2.926c-2.064 0-3.096.888-3.096 2.663V143h-5.686l-19.332-54.771c-.186 29.09-.186 44.796 0 47.117.187 2.321 1.54 3.767 4.06 4.337l-.324 3.317H347v-3.317c4.317-.65 6.692-2.46 7.125-5.427V70.68zm-68.842 64.887V68.684h-5.235c-1.71 3.38-3.725 8.734-6.048 16.065V64h32v21.205c-2.257-7.634-4.31-13.104-6.159-16.407h-5.57v66.768c0 2.746 1.72 4.119 5.157 4.119V143H279.57v-3.315s5.714 0 5.714-4.12zm169.535-63.461c0-3.264-1.94-4.895-5.818-4.895V64h20v3.21c-4.44 0-6.661 1.631-6.661 4.895v61.607c0 4.137 2.22 6.205 6.661 6.205V143h-20v-3.083c3.879 0 5.818-2.068 5.818-6.205V72.105zm48.948 45.053l3.014.684c.22 1.14.22 4.216.22 5.242 0 13.447-5.06 21.916-15.601 21.916-12.737 0-17.19-20.258-18.177-37.036-.938-15.959.987-28.815 7.856-39.047 2.88-4.288 7.761-6.12 11.538-6.12 3.843 0 7.137 2.66 8.784 5.736 1.757-2.165 3.075-3.798 4.173-6.533v30.69H501.4l-.11-9.266c-.339-13.903-4.282-16.714-8.783-16.714-8.405 0-8.405 15.271-8.405 36.012v3.418c0 16.866-.06 34.834 7.846 34.834 1.866 0 5.24.225 6.447-.914 3.953-4.103 5.59-10.936 5.48-17.432l-.109-5.47zm10.062-45.562c0-2.756-1.572-4.134-4.717-4.134V64h19.336v3.462c-3.834 0-5.751 1.378-5.751 4.134v31.211c9.546-19.18 13.959-27.078 15.74-31.211 1.782-4.134-2.073-4.134-6.007-4.134V64H550v3.462c-1.193.236-3.494 2.589-4.95 5.109-1.364 2.359-4.823 8.157-10.379 19.344 5.758 28.95 9.842 43.365 10.3 45.195.456 1.83 2.133 2.817 5.029 2.964V143h-17.571v-2.926c3.052 0 4.363-.988 3.934-2.964-.43-1.977-2.92-13.668-7.472-35.073l-6.195 10.834v24.239c0 1.976 1.917 2.964 5.75 2.964V143H509v-2.926c3.219 0 4.828-.988 4.828-2.964V71.596zm53.487-.748c.214-1.975-.774-3.32-2.962-4.036l.072-2.812h17.005v2.812c-2.189.194-3.189 1.54-3 4.036.285 3.745 8.193 57.635 9.132 63.639.626 4.003 2.106 5.886 4.438 5.652V143h-17.848v-2.861c3.492.234 4.918-1.65 4.279-5.652-.64-4.003-1.2-8.424-1.68-13.265l-12.398.116a2365.28 2365.28 0 0 0-2.025 13.149c-.603 4.003.328 5.886 2.795 5.652V143H554v-2.861c1.405.234 2.417-1.65 3.035-5.652.927-6.004 9.96-60.676 10.28-63.639zM575 116l-5.778-34L564 116h11zm60.26-43.354c0-3.88-2.087-5.82-6.26-5.82V64h17.353C662.497 64 667 87.876 667 103.67c0 10.603-1.867 26.244-9.775 34.366-3.734 3.836-7.358 4.964-15.375 4.964H630.9v-2.98c2.907 0 4.36-1.85 4.36-5.549V72.646zM642.824 68H640v72h2.118c4.706 0 6.353-1.578 7.53-2.793 3.646-3.642 6.352-10.32 6.352-28.654v-9.106C656 85.12 654.235 68 642.824 68z"/>
      </svg>
    </A>
  )
}

export const ModeToggle = ({ ...props }) => {
  const [colorMode, setColorMode] = useColorMode()
  return (
    <Button
      variant="icon"
      onClick={() => setColorMode(colorMode === "default" ? "dark" : "default")}
      ml={[2, 4]}
      hoverColor="primary"
      focusColor="text"
      {...props}
    >
      <Icon name={colorMode === "default" ? "sun" : "moon"} size="5" />
      <VisuallyHidden>Toggle mode</VisuallyHidden>
    </Button>
  )
}
